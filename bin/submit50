#!/usr/bin/env python

import argparse
import logging
import signal
import sys

from submit50 import submit
from submit50 import colors

def sigint_handler(signal_number, stack_frame):
    print(colors.red('\nInterrupted.'))
    sys.exit(130)
signal.signal(signal.SIGINT, sigint_handler)

def main():
    args = parse_args(sys.argv[1:])
    configure_logging(args.verbose)
    try:
        submit(args.assignment, args.username)
    except (AssertionError, RuntimeError, ValueError) as ex:
        logging.info(colors.red(ex))
    else:
        logging.info(colors.green(f'Successfully submitted {args.assignment}.'))

def parse_args(args):
    parser = argparse.ArgumentParser(
        description='A git wrapper for submitting GitHub Classroom assignments.'
    )
    parser.add_argument(
        '--verbose',
        action='store_true'
    )
    parser.add_argument(
        'assignment',
        metavar='ASSIGNMENT',
        type=str,
        help='the assignment repository (e.g., classroom50/hello)'
    )
    parser.add_argument(
        'username',
        metavar='USERNAME',
        type=str,
        help='the username in your copy of the assignment'
    )
    return parser.parse_args(args)

def configure_logging(verbose):
    logging.basicConfig(format='%(message)s', level=logging.DEBUG if verbose else logging.INFO)


if __name__ == '__main__':
    main()
